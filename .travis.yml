os: linux
dist: bionic
language: ruby
before_install:
  - export ROOT_DIR=`pwd`
  - export NEKSTAB_SOURCE_ROOT=$ROOT_DIR
  - export NEK_SOURCE_ROOT=$NEKSTAB_SOURCE_ROOT/Nek5000
  - export PATH=$NEK_SOURCE_ROOT/bin:$PATH
  - sudo apt-get -y install libmpich-dev mpich libopenblas-dev
addons:
  apt:
    update: true

env:
  global:
    - MAKEFLAGS="-j 4"

install: true

script:
  - lscpu
  - echo $ROOT_DIR
  - echo $NEKSTAB_SOURCE_ROOT
  - echo $NEK_SOURCE_ROOT
  - cd examples/1cyl
  - ./cmpile.sh all
  - export CASE='1cyl'
  - export CASE_DIR=`pwd`
  - echo $CASE > SESSION.NAME
  - echo $CASE_DIR'/' >> SESSION.NAME
  - mpiexec -np 4 ./nek5000
